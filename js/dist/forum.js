(()=>{var t={n:n=>{var s=n&&n.__esModule?()=>n.default:()=>n;return t.d(s,{a:s}),s},d:(n,s)=>{for(var i in s)t.o(s,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:s[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const s=flarum.core.compat["forum/app"];var i=t.n(s);function o(t,n){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},o(t,n)}function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n)}const e=flarum.core.compat["common/Model"];var a=t.n(e),c=function(t){function n(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).name=a().attribute("name"),n.isPublic=a().attribute("isPublic"),n.ordering=a().attribute("ordering"),n.discussionCount=a().attribute("discussionCount"),n.canEdit=a().attribute("canEdit"),n.discussions=a().hasMany("discussions"),n}return r(n,t),n}(a());const l=flarum.core.compat["forum/components/IndexPage"];var u=t.n(l);const d=flarum.core.compat["common/extend"],f=flarum.core.compat["forum/components/DiscussionPage"];var p=t.n(f);const h=flarum.core.compat["common/Component"];var v=t.n(h);const g=flarum.core.compat["common/components/LoadingIndicator"];var y=t.n(g);const b=flarum.core.compat["common/components/Button"];var k=t.n(b);const w=flarum.core.compat["common/helpers/icon"];var L=t.n(w);const P=flarum.core.compat["common/components/Link"];var D=t.n(P);const O=flarum.core.compat["common/components/Modal"];var x=t.n(O);const S=flarum.core.compat["common/components/Select"];var E=t.n(S);const M=flarum.core.compat["common/components/Switch"];var A=t.n(M);const C=flarum.core.compat["common/utils/extractText"];var N=t.n(C),T=function(t){function n(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).name="",n.isPublic=!1,n.ordering="manual",n.deleting=!1,n}r(n,t);var s=n.prototype;return s.oninit=function(n){t.prototype.oninit.call(this,n),this.attrs.list?(this.name=this.attrs.list.name(),this.isPublic=this.attrs.list.isPublic(),this.ordering=this.attrs.list.ordering()):i().forum.attribute("canCreatePrivateDiscussionLists")||(this.isPublic=!0)},s.className=function(){return"EditDiscussionListModal Modal--small"},s.title=function(){return i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.title")},s.content=function(){var t=this;return m(".Modal-body",[m(".Form-group",[m("label",{for:"edit-list-modal-name"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.name")),m("input",{id:"edit-list-modal-name",type:"text",className:"FormControl",value:this.name,onchange:function(n){t.name=n.target.value}})]),m(".Form-group",[A().component({state:this.isPublic,onchange:function(n){t.isPublic=n},disabled:i().forum.attribute("canCreatePublicDiscussionLists")!==i().forum.attribute("canCreatePrivateDiscussionLists")},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.isPublic"))]),m(".Form-group",[m("label",i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.ordering")),E().component({value:this.ordering,onchange:function(n){t.ordering=n},options:{manual:i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.manual"),"created:asc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.createdAsc"),"created:desc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.createdDesc"),"added:asc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.addedAsc"),"added:desc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.addedDesc")}})]),m(".Form-group",[k().component({type:"submit",className:"Button Button--primary EditDiscussionListModal-save",loading:this.loading},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.save")),this.attrs.list?k().component({type:"button",className:"Button EditDiscussionListModal-delete",onclick:function(){confirm(N()(i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.deleteConfirmation")))&&(t.deleting=!0,t.attrs.list.delete({errorHandler:t.onerror.bind(t)}).then((function(){t.hide(),t.attrs.ondelete&&t.attrs.ondelete()}),(function(){t.deleting=!1,m.redraw()})))}},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.delete")):null])])},s.onsubmit=function(t){var n=this;t.preventDefault(),this.loading=!0,(this.attrs.list||i().store.createRecord("discussion-lists")).save({name:this.name,isPublic:this.isPublic,ordering:this.ordering},{errorHandler:this.onerror.bind(this)}).then((function(){n.hide(),n.attrs.onsave&&n.attrs.onsave()}),(function(){n.loading=!1,m.redraw()}))},n}(x()),I=function(t){function n(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).loading=!1,n}r(n,t);var s=n.prototype;return s.view=function(){var t=this,n=this.attrs,s=n.list,o=n.discussion,r=-1!==(s.discussions()||[]).indexOf(o);return m("li",[k().component({onclick:function(){t.loading=!0,i().request({url:i().forum.attribute("apiUrl")+"/discussion-lists/"+s.id()+"/discussions/"+o.id(),method:r?"DELETE":"POST"}).then((function(n){i().store.pushPayload(n),t.loading=!1,m.redraw()})).catch((function(n){throw t.loading=!1,m.redraw(),n}))}},L()(this.icon(r))),D().component({href:i().route("discussionList",{list:s.id()})},[s.name(),s.isPublic()?null:[" ",m("span.discussion-list-private",L()("fas fa-lock"))]]),k().component({onclick:function(){i().modal.show(T,{list:s,ondelete:t.attrs.ondelete})}},L()("fas fa-pen"))])},s.icon=function(t){return this.loading?"fas fa-spinner fa-pulse":t?"far fa-check-square":"far fa-square"},n}(v()),B=function(t){function n(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).lists=void 0,n.loading=!0,n}r(n,t);var s=n.prototype;return s.oninit=function(n){t.prototype.oninit.call(this,n),this.refresh()},s.refresh=function(){var t=this;this.loading=!0,i().store.find("discussion-lists",{filter:{user:i().session.user.slug()}}).then((function(n){t.lists=n,t.loading=!1,m.redraw()}))},s.view=function(){var t=this;return this.loading?[y().component()]:[].concat(this.lists.map((function(n){return m(I,{discussion:t.attrs.discussion,list:n,ondelete:function(){t.refresh()}})})),[k().component({onclick:function(){i().modal.show(T,{onsave:function(){t.refresh()}})},icon:"fas fa-plus"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.discussion.new"))])},n}(v());const j=flarum.core.compat["common/components/Dropdown"];var _=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n.prototype.getMenu=function(n){var s=t.prototype.getMenu.call(this,n);return s.attrs.onclick=function(t){t.stopPropagation(),t.redraw=!1},s},n}(t.n(j)());const q=flarum.core.compat["forum/states/DiscussionListState"];var H=t.n(q);const F=flarum.core.compat["forum/states/GlobalSearchState"];var U=t.n(F);const z=flarum.core.compat["forum/components/DiscussionList"];var G=t.n(z);const R=flarum.core.compat["forum/components/DiscussionListItem"];var V=t.n(R);const J=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/Sortable"];var K=t.n(J);const Q=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/SortableHandle"];var W=t.n(Q),X=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n.prototype.view=function(){var t=this.attrs.list;return m("header.Hero.ListHero",m(".container",m(".containerNarrow",[m("h2.Hero-title",[t.name(),t.isPublic()?null:[" ",m("span.discussion-list-private",L()("fas fa-lock"))]]),t.canEdit()?k().component({onclick:function(){i().modal.show(T,{list:t,onsave:function(){i().discussions.refresh()},ondelete:function(){m.route.set(i().route("index"))}})}},"Edit"):null])))},n}(v());const Y=flarum.core.compat["common/components/LinkButton"];var Z=t.n(Y);const $=flarum.core.compat["forum/components/UserPage"];var tt=t.n($),nt=function(t){function n(){for(var n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).lists=[],n.loading=!1,n}r(n,t);var s=n.prototype;return s.oninit=function(n){t.prototype.oninit.call(this,n),this.loadUser(m.route.param("username"))},s.show=function(n){t.prototype.show.call(this,n),this.refresh()},s.refresh=function(){var t=this;this.loading=!0,this.lists=[],m.redraw(),i().store.find("discussion-lists",{filter:{user:this.user.slug()}}).then((function(n){t.lists=n,t.loading=!1,m.redraw()}),(function(){t.loading=!1,m.redraw()}))},s.content=function(){return this.loading?y().component():m("ul",this.lists.map((function(t){return m("li",D().component({href:i().route("discussionList",{list:t.id()})},[t.name(),t.isPublic()?null:[" ",m("span.discussion-list-private",L()("fas fa-lock"))]," ",m("span.discussion-list-count","("+t.discussionCount()+")")]))})))},n}(tt());i().initializers.add("clarkwinkelmann-discussion-lists",(function(){i().store.models["discussion-lists"]=c,i().routes.discussionList={path:"/discussion-lists/:list",component:u()},(0,d.extend)(p().prototype,"sidebarItems",(function(t){i().session.user&&(i().forum.attribute("canCreatePublicDiscussionLists")||i().forum.attribute("canCreatePrivateDiscussionLists"))&&t.add("lists",_.component({buttonClassName:"Button",icon:"fas fa-list-ol",label:i().translator.trans("clarkwinkelmann-discussion-lists.forum.discussion.add"),lazyDraw:!0},m(B,{discussion:this.discussion})),75)})),u().prototype.currentList=function(){var t=this;if(this.currentActiveList)return this.currentActiveList;var n=i().search.params().list;if(!n)return null;var s=i().store.getById("discussion-lists",n);return s?(this.currentActiveList=s,this.currentActiveList):(this.currentListLoading||(this.currentListLoading=!0,i().store.find("discussion-lists",n).then((function(n){t.currentActiveList=n,m.redraw()})).finally((function(){t.currentListLoading=!1}))),null)},(0,d.override)(u().prototype,"hero",(function(t){var n=this.currentList();return n?m(X,{list:n}):t()})),(0,d.extend)(u().prototype,"view",(function(t){var n=this.currentList();n&&(t.attrs.className+=" IndexPage--list"+n.id())})),(0,d.extend)(u().prototype,"setTitle",(function(){var t=this.currentList();t&&i().setTitle(t.name())})),(0,d.extend)(U().prototype,"params",(function(t){t.list=m.route.param("list")})),(0,d.extend)(H().prototype,"requestParams",(function(t){if(this.params.list){var n,s,i=null!=(n=t.filter)?n:{};i.list=this.params.list;var o=i.q;o&&(i.q=o+" list:"+this.params.list),t.filter=i;var r=null!=(s=t.page)?s:{};r.limit=50,t.page=r}})),(0,d.override)(H().prototype,"sortMap",(function(t){var n=t();if(!this.params.list)return n;var s={discussionListDefault:""};return Object.keys(n).forEach((function(t){n[t]&&(s[t]=n[t])})),s})),(0,d.override)(G().prototype,"view",(function(t){var n=t(),s=this.attrs.state;if(!s.getParams().list)return n;var o=i().store.getById("discussion-lists",s.getParams().list);if(!o||"manual"!==o.ordering()||!o.canEdit())return n;if(!n.children.length||!n.children[0]&&!n.children[0].attrs&&"feed"!==n.children[0].attrs.role)return n;var r=[];return n.children[0].children.forEach((function(t){t&&("["===t.tag?r.push.apply(r,t.children):r.push(t))})),m("div",{className:n.attrs.className},{tag:K(),attrs:{containerTag:"ul[role=feed][aria-busy=false]."+n.children[0].attrs.className.replace(" ","."),placeholderTag:"li.DiscussionListSortablePlaceholder",onsort:function(t,n){var r,e=(r=[]).concat.apply(r,s.getPages().map((function(t){return t.items})))[t];e&&o&&i().request({url:i().forum.attribute("apiUrl")+"/discussion-lists/"+o.id()+"/discussions/"+e.id(),method:"POST",body:{order:n+1}}).then((function(t){i().store.pushPayload(t),i().discussions.refresh()}))}},children:r})})),(0,d.extend)(V().prototype,"view",(function(t){if(this.attrs.params.list){var n=i().store.getById("discussion-lists",this.attrs.params.list);if(!n||"manual"!==n.ordering()||!n.canEdit())return t;t.children.forEach((function(t){t&&t.attrs&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.unshift(m(W(),{className:"DiscussionListSortableHandle"}))}))}})),i().routes["user.discussionLists"]={path:"/u/:username/discussion-lists",component:nt},(0,d.extend)(tt().prototype,"navItems",(function(t){this.user.attribute("discussionListsTabVisible")&&t.add("discussionLists",Z().component({href:i().route("user.discussionLists",{username:this.user.slug()}),name:"mentions",icon:"fas fa-list-ol"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.profile.link")),10)}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map