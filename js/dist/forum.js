(()=>{var t={n:s=>{var n=s&&s.__esModule?()=>s.default:()=>s;return t.d(n,{a:n}),n},d:(s,n)=>{for(var i in n)t.o(n,i)&&!t.o(s,i)&&Object.defineProperty(s,i,{enumerable:!0,get:n[i]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const n=flarum.core.compat["forum/app"];var i=t.n(n);function o(t,s){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},o(t,s)}function e(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,o(t,s)}const r=flarum.core.compat["common/Model"];var a=t.n(r),c=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).name=a().attribute("name"),s.visibility=a().attribute("visibility"),s.ordering=a().attribute("ordering"),s.discussionCount=a().attribute("discussionCount"),s.canEdit=a().attribute("canEdit"),s.user=a().hasOne("user"),s.discussions=a().hasMany("discussions"),s}return e(s,t),s}(a());const l=flarum.core.compat["forum/components/IndexPage"];var u=t.n(l);const d=flarum.core.compat["common/extend"],p=flarum.core.compat["forum/components/DiscussionPage"];var f=t.n(p);const h=flarum.core.compat["common/components/Dropdown"];var v=t.n(h);const g=flarum.core.compat["common/Component"];var y=t.n(g);const b=flarum.core.compat["common/components/LoadingIndicator"];var w=t.n(b);const k=flarum.core.compat["common/components/Button"];var L=t.n(k);const D=flarum.core.compat["common/helpers/icon"];var x=t.n(D);const S=flarum.core.compat["common/components/Link"];var P=t.n(S);const B=flarum.core.compat["common/components/Modal"];var N=t.n(B);const O=flarum.core.compat["common/components/Select"];var C=t.n(O);const E=flarum.core.compat["common/utils/extractText"];var I=t.n(E),A=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).name="",s.visibility="private",s.ordering="manual",s.deleting=!1,s}e(s,t);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.attrs.list?(this.name=this.attrs.list.name(),this.visibility=this.attrs.list.visibility(),this.ordering=this.attrs.list.ordering()):i().forum.attribute("canCreatePrivateDiscussionLists")||(i().forum.attribute("canCreatePublicDiscussionLists")?this.visibility="public":this.visibility="series")},n.className=function(){return"EditDiscussionListModal Modal--small"},n.title=function(){return i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.title")},n.content=function(){var t=this,s={};return i().forum.attribute("canCreatePrivateDiscussionLists")&&(s.private=i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.visibilityOptions.private")),i().forum.attribute("canCreatePublicDiscussionLists")&&(s.public=i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.visibilityOptions.public")),i().forum.attribute("canCreateSeriesDiscussionLists")&&(s.series=i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.visibilityOptions.series")),m(".Modal-body",[m(".Form-group",[m("label",{for:"edit-list-modal-name"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.name")),m("input",{id:"edit-list-modal-name",type:"text",className:"FormControl",value:this.name,onchange:function(s){t.name=s.target.value}})]),m(".Form-group",[m("label",i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.visibility")),C().component({value:this.visibility,onchange:function(s){t.visibility=s},options:s,disabled:(i().forum.attribute("canCreatePrivateDiscussionLists")?1:0)+(i().forum.attribute("canCreatePublicDiscussionLists")?1:0)+(i().forum.attribute("canCreateSeriesDiscussionLists")?1:0)<=1})]),m(".Form-group",[m("label",i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.ordering")),C().component({value:this.ordering,onchange:function(s){t.ordering=s},options:{manual:i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.manual"),"created:asc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.createdAsc"),"created:desc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.createdDesc"),"added:asc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.addedAsc"),"added:desc":i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.orderingOptions.addedDesc")}})]),m(".Form-group",[L().component({type:"submit",className:"Button Button--primary EditDiscussionListModal-save",loading:this.loading},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.save")),this.attrs.list?L().component({type:"button",className:"Button EditDiscussionListModal-delete",onclick:function(){confirm(I()(i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.deleteConfirmation")))&&(t.deleting=!0,t.attrs.list.delete({errorHandler:t.onerror.bind(t)}).then((function(){t.hide(),t.attrs.ondelete&&t.attrs.ondelete()}),(function(){t.deleting=!1,m.redraw()})))}},i().translator.trans("clarkwinkelmann-discussion-lists.forum.edit.delete")):null])])},n.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,(this.attrs.list||i().store.createRecord("discussion-lists")).save({name:this.name,visibility:this.visibility,ordering:this.ordering},{errorHandler:this.onerror.bind(this)}).then((function(){s.hide(),s.attrs.onsave&&s.attrs.onsave()}),(function(){s.loading=!1,m.redraw()}))},s}(N());const M=flarum.core.compat["common/components/Tooltip"];var T=t.n(M),H=function(t){function s(){return t.apply(this,arguments)||this}return e(s,t),s.prototype.view=function(){var t=null,s=null;switch(this.attrs.list.visibility()){case"private":t="fas fa-lock",s=I()(i().translator.trans("clarkwinkelmann-discussion-lists.forum.badge.private"));break;case"series":t="fas fa-list-ol",s=I()(i().translator.trans("clarkwinkelmann-discussion-lists.forum.badge.series"))}return t?[" ",T().component({text:s},m("span.discussion-list-"+this.attrs.list.visibility(),x()(t)))]:null},s}(y()),j=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).loading=!1,s}e(s,t);var n=s.prototype;return n.view=function(){var t=this,s=this.attrs,n=s.list,o=s.discussion,e=-1!==(n.discussions()||[]).indexOf(o);return m("li.DiscussionListsDropdownEntry",[L().component({onclick:function(){t.loading=!0,i().request({url:i().forum.attribute("apiUrl")+"/discussion-lists/"+n.id()+"/discussions/"+o.id(),method:e?"DELETE":"POST"}).then((function(s){i().store.pushPayload(s),t.loading=!1,m.redraw()})).catch((function(s){throw t.loading=!1,m.redraw(),s}))}},x()(this.icon(e))),P().component({href:i().route("discussionList",{list:n.id()})},[n.name(),H.component({list:n})]),L().component({onclick:function(){i().modal.show(A,{list:n,ondelete:t.attrs.ondelete})}},x()("fas fa-pen"))])},n.icon=function(t){return this.loading?"fas fa-spinner fa-pulse":t?"far fa-check-square":"far fa-square"},s}(y()),_=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).lists=void 0,s.loading=!0,s}e(s,t);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.refresh()},n.refresh=function(){var t=this;this.loading=!0,i().store.find("discussion-lists",{filter:{user:i().session.user.slug()}}).then((function(s){t.lists=s,t.loading=!1,m.redraw()}))},n.view=function(){var t=this;return this.loading?[w().component()]:[].concat(this.lists.map((function(s){return m(j,{discussion:t.attrs.discussion,list:s,ondelete:function(){t.refresh()}})})),[m("li",L().component({onclick:function(){i().modal.show(A,{onsave:function(){t.refresh()}})},icon:"fas fa-plus"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.discussion.new")))])},s}(y()),q=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).attrs=void 0,s}e(s,t),s.initAttrs=function(s){t.initAttrs.call(this,s),s.className="DiscussionListsDropdown",s.buttonClassName="Button",s.icon="fas fa-list-ol",s.label=i().translator.trans("clarkwinkelmann-discussion-lists.forum.discussion.add"),s.lazyDraw=!0};var n=s.prototype;return n.view=function(t){return m("div",{className:"ButtonGroup Dropdown dropdown "+this.attrs.className+" itemCount1"+(this.showing?" open":"")},[this.getButton(t.children),this.showing&&this.getMenu([])])},n.getMenu=function(t){return m("ul.Dropdown-menu.dropdown-menu",{onclick:function(t){t.stopPropagation(),t.redraw=!1}},_.component({discussion:this.attrs.discussion}))},s}(v());function F(){return!!i().session.user&&(i().forum.attribute("canCreatePrivateDiscussionLists")||i().forum.attribute("canCreatePublicDiscussionLists")||i().forum.attribute("canCreateSeriesDiscussionLists"))}const U=flarum.core.compat["forum/states/DiscussionListState"];var z=t.n(U);const G=flarum.core.compat["forum/states/GlobalSearchState"];var V=t.n(G);const R=flarum.core.compat["forum/components/DiscussionList"];var W=t.n(R);const J=flarum.core.compat["forum/components/DiscussionListItem"];var K=t.n(J);const Q=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/Sortable"];var X=t.n(Q);const Y=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/SortableHandle"];var Z=t.n(Y);const $=flarum.core.compat["common/helpers/avatar"];var tt=t.n($);const st=flarum.core.compat["common/helpers/username"];var nt=t.n(st),it=function(t){function s(){return t.apply(this,arguments)||this}return e(s,t),s.prototype.view=function(){var t=this.attrs.list,s=t.user();return m("header.Hero.ListHero",m(".container",[t.canEdit()?L().component({className:"Button Button--icon ListHero-Edit",icon:"fas fa-pen",onclick:function(){i().modal.show(A,{list:t,onsave:function(){i().discussions.refresh()},ondelete:function(){m.route.set(i().route("index"))}})}}):null,m("h2.Hero-title",[t.name(),H.component({list:t})]),s?m(".Hero-author",[tt()(s)," ",P().component({href:i().route.user(s)},nt()(s))]):null]))},s}(y());const ot=flarum.core.compat["common/components/LinkButton"];var et=t.n(ot);const rt=flarum.core.compat["forum/components/UserPage"];var at=t.n(rt),ct=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).lists=[],s.loading=!1,s}e(s,t);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.loadUser(m.route.param("username"))},n.show=function(s){t.prototype.show.call(this,s),this.refresh()},n.refresh=function(){var t=this;this.loading=!0,this.lists=[],m.redraw(),i().store.find("discussion-lists",{filter:{user:this.user.slug()}}).then((function(s){t.lists=s,t.loading=!1,m.redraw()}),(function(){t.loading=!1,m.redraw()}))},n.content=function(){return this.loading?w().component():m("ul",this.lists.map((function(t){return m("li",P().component({href:i().route("discussionList",{list:t.id()})},[t.name(),H.component({list:t})," ",m("span.discussion-list-count","("+t.discussionCount()+")")]))})))},s}(at());const lt=flarum.core.compat["common/models/Discussion"];var ut=t.n(lt);const mt=flarum.core.compat["forum/components/DiscussionHero"];var dt=t.n(mt),pt=function(t){function s(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(s=t.call.apply(t,[this].concat(i))||this).expand=void 0,s}e(s,t);var n=s.prototype;return n.oninit=function(s){t.prototype.oninit.call(this,s),this.expand=!i().forum.attribute("collapseDiscussionListsSeries")},n.view=function(){var t=this,s=this.attrs.list;return m("nav.DiscussionListSeries",{className:this.attrs.className},[m(".DiscussionListSeriesHead",[i().forum.attribute("collapseDiscussionListsSeries")?T().component({text:I()(i().translator.trans("clarkwinkelmann-discussion-lists.forum.series.expand"))},L().component({className:"Button Button--icon DiscussionListSeriesExpandButton",icon:"fas fa-chevron-"+(this.expand?"up":"down"),onclick:function(){t.expand=!t.expand}})):null,m("h3",[s.name()," ",m("small",i().translator.trans("clarkwinkelmann-discussion-lists.forum.series.kind"))])]),this.expand?[m("ol",(s.discussions()||[]).map((function(s){return s?s===t.attrs.currentDiscussion?m("li.active",s.title()):m("li",P().component({href:i().route.discussion(s)},s.title())):null}))),m(".DiscussionListSeriesVisit",et().component({className:"Button",href:i().route("discussionList",{list:s.id()})},i().translator.trans("clarkwinkelmann-discussion-lists.forum.series.visit")))]:null])},s}(y()),ft=function(t){function s(){return t.apply(this,arguments)||this}e(s,t);var n=s.prototype;return n.view=function(){var t=(this.attrs.list.discussions()||[]).filter((function(t){return!!t})),s=t.indexOf(this.attrs.currentDiscussion);return-1===s?null:m(".SeriesNav",{className:s>0?"":"SeriesNav--only-next"},[s>0?this.link(t[s-1],"fas fa-angle-left","SeriesNav--prev"):null,s<t.length-1?this.link(t[s+1],"fas fa-angle-right","SeriesNav--next"):null])},n.link=function(t,s,n){return et().component({className:"Button "+n,href:i().route.discussion(t),icon:s},t.title())},s}(y());i().initializers.add("clarkwinkelmann-discussion-lists",(function(){i().store.models["discussion-lists"]=c,i().routes.discussionList={path:"/discussion-lists/:list",component:u()},(0,d.extend)(f().prototype,"sidebarItems",(function(t){F()&&t.add("lists",q.component({discussion:this.discussion}),75)})),"v17development/blog/pages/BlogItem"in flarum.core.compat&&(0,d.extend)(flarum.core.compat["v17development/blog/pages/BlogItem"].prototype,"contentItems",(function(t){F()&&this.article&&t.add("lists",m(".FlarumBlog-Article-Content-Lists-Button",q.component({discussion:this.article})),78)})),u().prototype.currentList=function(){var t=this;if(this.currentActiveList)return this.currentActiveList;var s=i().search.params().list;if(!s)return null;var n=i().store.getById("discussion-lists",s);return n?(this.currentActiveList=n,this.currentActiveList):(this.currentListLoading||(this.currentListLoading=!0,i().store.find("discussion-lists",s).then((function(s){t.currentActiveList=s,m.redraw()})).finally((function(){t.currentListLoading=!1}))),null)},(0,d.override)(u().prototype,"hero",(function(t){var s=this.currentList();return s?m(it,{list:s}):t()})),(0,d.extend)(u().prototype,"view",(function(t){var s=this.currentList();s&&(t.attrs.className+=" IndexPage--list"+s.id())})),(0,d.extend)(u().prototype,"setTitle",(function(){var t=this.currentList();t&&i().setTitle(t.name())})),(0,d.extend)(V().prototype,"params",(function(t){t.list=m.route.param("list")})),(0,d.extend)(z().prototype,"requestParams",(function(t){if(this.params.list){var s,n,i=null!=(s=t.filter)?s:{};i.list=this.params.list;var o=i.q;o&&(i.q=o+" list:"+this.params.list),t.filter=i;var e=null!=(n=t.page)?n:{};e.limit=50,t.page=e}})),(0,d.override)(z().prototype,"sortMap",(function(t){var s=t();if(!this.params.list)return s;var n={discussionListDefault:""};return Object.keys(s).forEach((function(t){s[t]&&(n[t]=s[t])})),n})),(0,d.override)(W().prototype,"view",(function(t){var s=t(),n=this.attrs.state;if(!n.getParams().list||n.getParams().sort)return s;var o=i().store.getById("discussion-lists",n.getParams().list);if(!o||"manual"!==o.ordering()||!o.canEdit())return s;if(!s.children.length||!s.children[0]&&!s.children[0].attrs&&"feed"!==s.children[0].attrs.role)return s;var e=[];return s.children[0].children.forEach((function(t){t&&("["===t.tag?e.push.apply(e,t.children):e.push(t))})),m("div",{className:s.attrs.className},{tag:X(),attrs:{containerTag:"ul[role=feed][aria-busy=false]."+s.children[0].attrs.className.replace(" ","."),placeholderTag:"li.DiscussionListSortablePlaceholder",onsort:function(t,s){var e,r=(e=[]).concat.apply(e,n.getPages().map((function(t){return t.items})))[t];r&&o&&i().request({url:i().forum.attribute("apiUrl")+"/discussion-lists/"+o.id()+"/discussions/"+r.id(),method:"POST",body:{data:{attributes:{order:s+1}}}}).then((function(t){i().store.pushPayload(t),i().discussions.refresh()}))}},children:e})})),(0,d.extend)(K().prototype,"view",(function(t){if(this.attrs.params.list&&!this.attrs.params.sort){var s=i().store.getById("discussion-lists",this.attrs.params.list);if(!s||"manual"!==s.ordering()||!s.canEdit())return t;t.children.forEach((function(t){t&&t.attrs&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.unshift(m(Z(),{className:"DiscussionListSortableHandle"}))}))}})),i().routes["user.discussionLists"]={path:"/u/:username/discussion-lists",component:ct},(0,d.extend)(at().prototype,"navItems",(function(t){this.user.attribute("discussionListsTabVisible")&&t.add("discussionLists",et().component({href:i().route("user.discussionLists",{username:this.user.slug()}),name:"mentions",icon:"fas fa-list-ol"},i().translator.trans("clarkwinkelmann-discussion-lists.forum.profile.link")),10)})),ut().prototype.seriesDiscussionLists=a().hasMany("seriesDiscussionLists"),(0,d.extend)(dt().prototype,"items",(function(t){var s=this;(this.attrs.discussion.seriesDiscussionLists()||[]).forEach((function(n){t.add("discussion-lists-series"+n.id(),pt.component({list:n,currentDiscussion:s.attrs.discussion}))}))})),"v17development/blog/components/BlogItemSidebar"in flarum.core.compat&&(0,d.extend)(flarum.core.compat["v17development/blog/components/BlogItemSidebar"].prototype,"items",(function(t){t.setPriority("author",50);var s=this.attrs.article;s&&(s.seriesDiscussionLists()||[]).forEach((function(n){t.add("discussion-lists-series"+n.id(),pt.component({className:"BlogSideWidget",list:n,currentDiscussion:s}),40)}))})),"v17development/blog/pages/BlogItem"in flarum.core.compat&&(0,d.extend)(flarum.core.compat["v17development/blog/pages/BlogItem"].prototype,"postItems",(function(t){var s,n=(null==(s=this.article)?void 0:s.seriesDiscussionLists())||[];1!==n.length||n[0].discussionCount()<2||t.add("series-navigation",ft.component({currentDiscussion:this.article,list:n[0]}),-10)}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map